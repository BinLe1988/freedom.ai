<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人档案 - Freedom.AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
        }
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1rem;
        }
        .profile-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }
        .profile-card .card-header {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
        }
        .skill-tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            margin: 0.25rem;
            display: inline-block;
        }
        .preference-item {
            background: #f8f9fa;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .edit-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white;
        }
        .stats-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-rocket me-2"></i>Freedom.AI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>仪表板
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/assessment">
                            <i class="fas fa-chart-line me-1"></i>自由度评估
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/opportunities">
                            <i class="fas fa-search me-1"></i>机会探索
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/learning">
                            <i class="fas fa-graduation-cap me-1"></i>学习规划
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/profile">
                            <i class="fas fa-user me-1"></i>个人档案
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">
                            <i class="fas fa-sign-out-alt me-1"></i>退出
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 个人档案头部 -->
    <div class="profile-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <div class="col-md-6">
                    <h1 class="mb-2">display_test_1755440297</h1>
                    <p class="mb-1">
                        <i class="fas fa-envelope me-2"></i>display_test_1755440297@example.com
                    </p>
                    <p class="mb-1">
                        <i class="fas fa-calendar me-2"></i>注册时间: 2025年08月17日
                    </p>
                    <p class="mb-0">
                        <i class="fas fa-clock me-2"></i>最后登录: 2025年08月17日 22:18
                    </p>
                </div>
                <div class="col-md-3 text-center">
                    <button class="btn edit-btn" onclick="toggleEditMode()">
                        <i class="fas fa-edit me-2"></i>编辑档案
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 主要内容 -->
    <div class="container mt-4">
        <div class="row">
            <!-- 左侧：基本信息和技能 -->
            <div class="col-md-8">
                <!-- 基本信息 -->
                <div class="card profile-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle me-2"></i>基本信息
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="profileForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">姓名</label>
                                    <input type="text" class="form-control" id="fullName" 
                                           value="测试用户" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">当前职位</label>
                                    <input type="text" class="form-control" id="occupation" 
                                           value="软件工程师" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">工作经验</label>
                                    <select class="form-control" id="experience" disabled>
                                        <option value="">请选择</option>
                                        <option value="1" >1年</option>
                                        <option value="2" >2年</option>
                                        <option value="3" selected>3年</option>
                                        <option value="5" >5年</option>
                                        <option value="10" >10年以上</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">所在地区</label>
                                    <input type="text" class="form-control" id="location" 
                                           value="北京市" readonly>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">个人简介</label>
                                    <textarea class="form-control" id="bio" rows="3" readonly>这是一个测试用户的个人简介</textarea>
                                </div>
                            </div>
                            <div class="d-none" id="saveButtons">
                                <button type="button" class="btn btn-success me-2" onclick="saveProfile()">
                                    <i class="fas fa-save me-2"></i>保存
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
                                    <i class="fas fa-times me-2"></i>取消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 技能和兴趣 -->
                <div class="card profile-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs me-2"></i>技能和兴趣
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 class="text-muted mb-3">专业技能</h6>
                            <div id="skillsContainer">
                                
                                    
                                        <span class="skill-tag">Python</span>
                                    
                                        <span class="skill-tag">JavaScript</span>
                                    
                                        <span class="skill-tag">React</span>
                                    
                                
                            </div>
                            <div class="mt-3 d-none" id="skillsEdit">
                                <input type="text" class="form-control" id="newSkill" placeholder="输入技能名称，按回车添加">
                                <small class="text-muted">按回车键添加技能</small>
                            </div>
                        </div>
                        
                        <div>
                            <h6 class="text-muted mb-3">兴趣领域</h6>
                            <div id="interestsContainer">
                                
                                    
                                        <span class="skill-tag">编程</span>
                                    
                                        <span class="skill-tag">技术</span>
                                    
                                        <span class="skill-tag">创新</span>
                                    
                                
                            </div>
                            <div class="mt-3 d-none" id="interestsEdit">
                                <input type="text" class="form-control" id="newInterest" placeholder="输入兴趣领域，按回车添加">
                                <small class="text-muted">按回车键添加兴趣</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 偏好设置 -->
                <div class="card profile-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-sliders-h me-2"></i>偏好设置
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- 查看模式 -->
                        <div id="preferencesView">
                            
                                <div class="preference-item">
                                    <strong>工作类型偏好:</strong> 
                                    <span id="workTypeDisplay">
                                        远程工作
                                        
                                    </span>
                                </div>
                                <div class="preference-item">
                                    <strong>薪资期望:</strong> 
                                    <span id="salaryDisplay">
                                        
                                            ¥15000 - ¥25000 / 月
                                        
                                    </span>
                                </div>
                                <div class="preference-item">
                                    <strong>地点偏好:</strong> 
                                    <span id="locationDisplay">
                                        
                                            北京, 上海, 深圳
                                        
                                    </span>
                                </div>
                                <div class="preference-item">
                                    <strong>行业偏好:</strong> 
                                    <span id="industryDisplay">
                                        
                                            互联网, 人工智能, 金融科技
                                        
                                    </span>
                                </div>
                                <div class="preference-item">
                                    <strong>公司规模偏好:</strong> 
                                    <span id="companySizeDisplay">
                                        中型公司
                                        
                                    </span>
                                </div>
                            
                        </div>

                        <!-- 编辑模式 -->
                        <div id="preferencesEdit" class="d-none">
                            <form id="preferencesForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">工作类型偏好</label>
                                        <select class="form-control" id="preferredWorkType">
                                            <option value="">请选择</option>
                                            <option value="remote" selected>远程工作</option>
                                            <option value="hybrid" >混合办公</option>
                                            <option value="onsite" >现场办公</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">公司规模偏好</label>
                                        <select class="form-control" id="companySizePreference">
                                            <option value="">请选择</option>
                                            <option value="startup" >初创公司</option>
                                            <option value="small" >小型公司</option>
                                            <option value="medium" selected>中型公司</option>
                                            <option value="large" >大型公司</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">最低薪资期望 (元/月)</label>
                                        <input type="number" class="form-control" id="salaryMin" 
                                               value="15000" 
                                               placeholder="例如: 15000">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">最高薪资期望 (元/月)</label>
                                        <input type="number" class="form-control" id="salaryMax" 
                                               value="25000" 
                                               placeholder="例如: 25000">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">地点偏好</label>
                                    <div id="locationPreferencesContainer">
                                        
                                            
                                                <span class="skill-tag location-tag">
                                                    北京 <i class="fas fa-times ms-1" onclick="removeLocationPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                                <span class="skill-tag location-tag">
                                                    上海 <i class="fas fa-times ms-1" onclick="removeLocationPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                                <span class="skill-tag location-tag">
                                                    深圳 <i class="fas fa-times ms-1" onclick="removeLocationPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                        
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control" id="newLocationPreference" placeholder="输入城市名称，按回车添加">
                                        <small class="text-muted">按回车键添加地点偏好</small>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">行业偏好</label>
                                    <div id="industryPreferencesContainer">
                                        
                                            
                                                <span class="skill-tag industry-tag">
                                                    互联网 <i class="fas fa-times ms-1" onclick="removeIndustryPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                                <span class="skill-tag industry-tag">
                                                    人工智能 <i class="fas fa-times ms-1" onclick="removeIndustryPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                                <span class="skill-tag industry-tag">
                                                    金融科技 <i class="fas fa-times ms-1" onclick="removeIndustryPreference(this)" style="cursor: pointer;"></i>
                                                </span>
                                            
                                        
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control" id="newIndustryPreference" placeholder="输入行业名称，按回车添加">
                                        <small class="text-muted">按回车键添加行业偏好</small>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：统计和快捷操作 -->
            <div class="col-md-4">
                <!-- 统计信息 -->
                <div class="stats-card">
                    <span class="stats-number">08/17</span>
                    <small>注册日期</small>
                </div>
                
                <div class="stats-card">
                    <span class="stats-number">3</span>
                    <small>掌握技能</small>
                </div>
                
                <div class="stats-card">
                    <span class="stats-number">3</span>
                    <small>兴趣领域</small>
                </div>

                <!-- 自由度评估结果 -->
                
                <div class="card profile-card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>自由度评估
                        </h6>
                    </div>
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <p class="text-muted mb-3">还没有进行自由度评估</p>
                        <a href="/assessment" class="btn btn-primary">
                            <i class="fas fa-play me-1"></i>开始评估
                        </a>
                    </div>
                </div>
                

                <!-- 快捷操作 -->
                <div class="card profile-card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-bolt me-2"></i>快捷操作
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/assessment" class="btn btn-outline-primary">
                                <i class="fas fa-chart-line me-2"></i>开始评估
                            </a>
                            <a href="/opportunities" class="btn btn-outline-success">
                                <i class="fas fa-search me-2"></i>发现机会
                            </a>
                            <a href="/learning" class="btn btn-outline-info">
                                <i class="fas fa-graduation-cap me-2"></i>学习规划
                            </a>
                            <button class="btn btn-outline-warning" onclick="exportData()">
                                <i class="fas fa-download me-2"></i>导出数据
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="card profile-card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-history me-2"></i>最近活动
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item mb-3">
                                <small class="text-muted">今天</small>
                                <p class="mb-1">访问了个人档案页面</p>
                            </div>
                            <div class="timeline-item mb-3">
                                <small class="text-muted">昨天</small>
                                <p class="mb-1">完成了自由度评估</p>
                            </div>
                            <div class="timeline-item">
                                <small class="text-muted">3天前</small>
                                <p class="mb-1">注册了账户</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let editMode = false;
        let originalData = {};

        function toggleEditMode() {
            editMode = !editMode;
            const form = document.getElementById('profileForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            const saveButtons = document.getElementById('saveButtons');
            const skillsEdit = document.getElementById('skillsEdit');
            const interestsEdit = document.getElementById('interestsEdit');
            const preferencesView = document.getElementById('preferencesView');
            const preferencesEdit = document.getElementById('preferencesEdit');
            const editBtn = document.querySelector('.edit-btn');

            if (editMode) {
                // 保存原始数据
                originalData = {};
                inputs.forEach(input => {
                    originalData[input.id] = input.value;
                });

                // 启用编辑
                inputs.forEach(input => {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                });
                
                saveButtons.classList.remove('d-none');
                skillsEdit.classList.remove('d-none');
                interestsEdit.classList.remove('d-none');
                
                // 切换偏好设置显示模式
                if (preferencesView) preferencesView.classList.add('d-none');
                if (preferencesEdit) preferencesEdit.classList.remove('d-none');
                
                editBtn.innerHTML = '<i class="fas fa-times me-2"></i>取消编辑';
                editBtn.classList.add('btn-secondary');
                editBtn.classList.remove('edit-btn');
            } else {
                cancelEdit();
            }
        }

        function cancelEdit() {
            editMode = false;
            const form = document.getElementById('profileForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            const saveButtons = document.getElementById('saveButtons');
            const skillsEdit = document.getElementById('skillsEdit');
            const interestsEdit = document.getElementById('interestsEdit');
            const preferencesView = document.getElementById('preferencesView');
            const preferencesEdit = document.getElementById('preferencesEdit');
            const editBtn = document.querySelector('.edit-btn, .btn-secondary');

            // 恢复原始数据
            inputs.forEach(input => {
                if (originalData[input.id] !== undefined) {
                    input.value = originalData[input.id];
                }
                input.setAttribute('readonly', 'readonly');
                if (input.tagName === 'SELECT') {
                    input.setAttribute('disabled', 'disabled');
                }
            });

            saveButtons.classList.add('d-none');
            skillsEdit.classList.add('d-none');
            interestsEdit.classList.add('d-none');
            
            // 切换偏好设置显示模式
            if (preferencesView) preferencesView.classList.remove('d-none');
            if (preferencesEdit) preferencesEdit.classList.add('d-none');
            
            editBtn.innerHTML = '<i class="fas fa-edit me-2"></i>编辑档案';
            editBtn.classList.remove('btn-secondary');
            editBtn.classList.add('edit-btn');
        }

        function saveProfile() {
            // 添加调试信息
            console.log('开始保存档案...');
            
            const locationPreferences = getCurrentLocationPreferences();
            const industryPreferences = getCurrentIndustryPreferences();
            
            console.log('获取到的地点偏好:', locationPreferences);
            console.log('获取到的行业偏好:', industryPreferences);
            
            const formData = {
                full_name: document.getElementById('fullName').value,
                bio: document.getElementById('bio').value,
                current_role: document.getElementById('occupation').value,
                location: document.getElementById('location').value,
                experience_years: parseInt(document.getElementById('experience').value) || null,
                skills: getCurrentSkills(),
                interests: getCurrentInterests(),
                
                // 偏好设置
                preferred_work_type: document.getElementById('preferredWorkType')?.value || null,
                company_size_preference: document.getElementById('companySizePreference')?.value || null,
                salary_expectations: {
                    min: parseInt(document.getElementById('salaryMin')?.value) || null,
                    max: parseInt(document.getElementById('salaryMax')?.value) || null,
                    currency: 'CNY'
                },
                location_preferences: locationPreferences,
                industry_preferences: industryPreferences
            };
            
            console.log('准备发送的数据:', formData);

            fetch('/api/update_profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                console.log('API响应状态:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('API响应数据:', data);
                if (data.success) {
                    alert('档案更新成功！');
                    location.reload();
                } else {
                    alert('更新失败: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('网络错误，请稍后重试');
            });
        }

        function getCurrentSkills() {
            const skillTags = document.querySelectorAll('#skillsContainer .skill-tag');
            return Array.from(skillTags).map(tag => {
                // 获取标签的文本内容，排除图标
                const textNode = tag.childNodes[0];
                return textNode ? textNode.textContent.trim() : '';
            }).filter(text => text.length > 0);
        }

        function getCurrentInterests() {
            const interestTags = document.querySelectorAll('#interestsContainer .skill-tag');
            return Array.from(interestTags).map(tag => {
                // 获取标签的文本内容，排除图标
                const textNode = tag.childNodes[0];
                return textNode ? textNode.textContent.trim() : '';
            }).filter(text => text.length > 0);
        }

        function getCurrentLocationPreferences() {
            console.log('开始获取地点偏好...');
            const locationTags = document.querySelectorAll('#locationPreferencesContainer .location-tag');
            console.log('找到的地点标签数量:', locationTags.length);
            console.log('地点标签元素:', locationTags);
            
            const preferences = Array.from(locationTags).map((tag, index) => {
                // 获取标签的文本内容，排除图标
                const textNode = tag.childNodes[0];
                const text = textNode ? textNode.textContent.trim() : '';
                console.log(`地点标签 ${index + 1}:`, tag, '文本:', text);
                return text;
            }).filter(text => text.length > 0);
            
            console.log('最终地点偏好:', preferences);
            return preferences;
        }

        function getCurrentIndustryPreferences() {
            console.log('开始获取行业偏好...');
            const industryTags = document.querySelectorAll('#industryPreferencesContainer .industry-tag');
            console.log('找到的行业标签数量:', industryTags.length);
            console.log('行业标签元素:', industryTags);
            
            const preferences = Array.from(industryTags).map((tag, index) => {
                // 获取标签的文本内容，排除图标
                const textNode = tag.childNodes[0];
                const text = textNode ? textNode.textContent.trim() : '';
                console.log(`行业标签 ${index + 1}:`, tag, '文本:', text);
                return text;
            }).filter(text => text.length > 0);
            
            console.log('最终行业偏好:', preferences);
            return preferences;
        }

        function addSkill(skillName) {
            if (skillName.trim()) {
                const container = document.getElementById('skillsContainer');
                const skillTag = document.createElement('span');
                skillTag.className = 'skill-tag';
                skillTag.innerHTML = skillName.trim() + ' <i class="fas fa-times ms-1" onclick="removeSkill(this)" style="cursor: pointer;"></i>';
                container.appendChild(skillTag);
            }
        }

        function addInterest(interestName) {
            if (interestName.trim()) {
                const container = document.getElementById('interestsContainer');
                const interestTag = document.createElement('span');
                interestTag.className = 'skill-tag';
                interestTag.innerHTML = interestName.trim() + ' <i class="fas fa-times ms-1" onclick="removeInterest(this)" style="cursor: pointer;"></i>';
                container.appendChild(interestTag);
            }
        }

        function removeSkill(element) {
            element.parentElement.remove();
        }

        function removeInterest(element) {
            element.parentElement.remove();
        }

        function addLocationPreference(locationName) {
            if (locationName.trim()) {
                const container = document.getElementById('locationPreferencesContainer');
                const locationTag = document.createElement('span');
                locationTag.className = 'skill-tag location-tag';
                locationTag.innerHTML = locationName.trim() + ' <i class="fas fa-times ms-1" onclick="removeLocationPreference(this)" style="cursor: pointer;"></i>';
                container.appendChild(locationTag);
            }
        }

        function removeLocationPreference(element) {
            element.parentElement.remove();
        }

        function addIndustryPreference(industryName) {
            if (industryName.trim()) {
                const container = document.getElementById('industryPreferencesContainer');
                const industryTag = document.createElement('span');
                industryTag.className = 'skill-tag industry-tag';
                industryTag.innerHTML = industryName.trim() + ' <i class="fas fa-times ms-1" onclick="removeIndustryPreference(this)" style="cursor: pointer;"></i>';
                container.appendChild(industryTag);
            }
        }

        function removeIndustryPreference(element) {
            element.parentElement.remove();
        }

        function exportData() {
            fetch('/api/export_data')
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'freedom_ai_data.json';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('导出失败，请稍后重试');
            });
        }

        function showAssessmentHistory() {
            fetch('/api/get_assessment_history')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayAssessmentHistory(data.history);
                    } else {
                        alert('获取评估历史失败: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('网络错误，请稍后重试');
                });
        }

        function displayAssessmentHistory(history) {
            const modalHtml = `
                <div class="modal fade" id="assessmentHistoryModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-history me-2"></i>自由度评估历史
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="assessment-history">
                                    ${history.map((assessment, index) => `
                                        <div class="card mb-3">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <span>评估 #${history.length - index}</span>
                                                <small class="text-muted">${new Date(assessment.timestamp).toLocaleString('zh-CN')}</small>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h6>综合自由度: ${(assessment.overall_score * 100).toFixed(1)}%</h6>
                                                        <div class="progress mb-2">
                                                            <div class="progress-bar" style="width: ${assessment.overall_score * 100}%"></div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <small class="text-muted">各维度得分:</small>
                                                        <ul class="list-unstyled small">
                                                            <li>财务自由: ${(assessment.individual_scores.financial * 100).toFixed(1)}%</li>
                                                            <li>时间自由: ${(assessment.individual_scores.time * 100).toFixed(1)}%</li>
                                                            <li>地理自由: ${(assessment.individual_scores.location * 100).toFixed(1)}%</li>
                                                            <li>技能自由: ${(assessment.individual_scores.skill * 100).toFixed(1)}%</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                <a href="/assessment" class="btn btn-primary">新的评估</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 移除已存在的模态框
            const existingModal = document.getElementById('assessmentHistoryModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 添加新的模态框
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 显示模态框
            const modal = new bootstrap.Modal(document.getElementById('assessmentHistoryModal'));
            modal.show();
        }

        // 事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            // 技能输入
            const newSkillInput = document.getElementById('newSkill');
            if (newSkillInput) {
                newSkillInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addSkill(this.value);
                        this.value = '';
                    }
                });
            }

            // 兴趣输入
            const newInterestInput = document.getElementById('newInterest');
            if (newInterestInput) {
                newInterestInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addInterest(this.value);
                        this.value = '';
                    }
                });
            }

            // 地点偏好输入
            const newLocationPreferenceInput = document.getElementById('newLocationPreference');
            if (newLocationPreferenceInput) {
                newLocationPreferenceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addLocationPreference(this.value);
                        this.value = '';
                    }
                });
            }

            // 行业偏好输入
            const newIndustryPreferenceInput = document.getElementById('newIndustryPreference');
            if (newIndustryPreferenceInput) {
                newIndustryPreferenceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addIndustryPreference(this.value);
                        this.value = '';
                    }
                });
            }
        });
    </script>
</body>
</html>